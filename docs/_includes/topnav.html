<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="{{ site.baseurl }}/">&nbsp;<span class="projectTitle"> {{site.topnav_title}}</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!-- entries without drop-downs appear here -->

{% assign topnav = site.data[page.topnav] %}
{% assign topnav_dropdowns = site.data[page.topnav].topnav_dropdowns %}

                    {% for folder in topnav.topnav %}
                         {% comment %} 
                         Notice: 
                            Liquid engine is very poor in working with boolean logic.
                            Also, somehow, it can not check equality of folder.url == '/' and page.url=='/' - something buggy here.
                            That's why below lines of li class are such ugly.
                         {% endcomment %}
                        <li 
                            {% if folder.url.size>1 and page.url contains folder.url %}class="active"{% endif %}
                            {% if folder.url.size<2 and page.url.size<2 %}class="active"{% endif %}>
                            <a href="{{ folder.url }}">{{ folder.title }}</a>   
                            {% if folder.folderitems %}
                            <ul>
                                {% for folderitem in folder.folderitems %}
                                    {% if folderitem.external_url %}
                                        <li><a href="{{ folderitem.external_url }}" target="_blank">{{folderitem.title}}</a></li>
                                    {% elsif page.url contains folderitem.url %}
                                        <li class="dropdownActive"><a href="{{ site.baseurl }}{{ folderitem.url }}">{{folderitem.title}}</a></li>
                                    {% else %}
                                        <li><a href="{{ site.baseurl }}{{ folderitem.url }}">{{folderitem.title}}</a></li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </li>
                {% endfor %}
                <!-- entries with drop-downs appear here --> 
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                {% for entry in topnav_dropdowns %}
                {% for folder in entry.folders %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ folder.title }}<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        {% for folderitem in folder.folderitems %}
                        {% if folderitem.external_url %}
                        <li><a href="{{ folderitem.external_url }}" target="_blank">{{folderitem.title}}</a></li>
                        {% elsif page.url contains folderitem.url %}
                        <li class="dropdownActive"><a href="{{ site.baseurl }}{{ folderitem.url }}">{{folderitem.title}}</a></li>
                        {% else %}
                        <li><a href="{{ site.baseurl }}{{ folderitem.url }}">{{folderitem.title}}</a></li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                {% endfor %}
                {% endfor %}
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>
