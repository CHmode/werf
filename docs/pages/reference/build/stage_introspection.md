---
title: Stage Introspection
sidebar: reference
permalink: reference/build/stage_introspection.html
---

Написание конфигурации на первых шагах усложняется отсутствием понимания того, что содержится в сборочном контейнере при выполнении инструкций.

В процессе сборки есть возможность получить доступ к определённой стадии, воспользовавшись опциями интроспекции. При интроспекции, как и при сборке, сборочный контейнер содержит служебныи инструментарий и переменные окружения. Инструментарий представляется в виде набора утилит, который необходим на время сборки. Его добавление осуществляется монтированием директорий из служебных контейнеров наших дистрибутивов dappdeps (в сборочном контейнере они доступны по пути /.dapp/deps). Интроспекция сводится к тому, что сборочный контейнер стадии запускается для пользователя в интерактивном режиме.

При разработке интроспекция позволяет прийти к необходимому результату в сборочном контейнере, а затем перенести все шаги, инструкции, в конфигурацию соответствующей стадии. Такой подход может быть полезен, когда поставленная задача ясна, но шаги для её решения не очевидны и требуют экспериментов.

При отладке интроспекция позволяет посмотреть, почему сборка завершилась с ошибкой или результат не соответствует ожиданиям, проверить наличие зависимых файлов, состояние системы.

Наконец, при использовании интроспекции приложений использующих ansible появляется возможность отладки ansible playbooks в сборочном контейнере с последующим переносом ansible-задач в соответствующие стадии конфигурации.

При сборке поддерживаются следующие опции интроспекции:

```bash
# интроспекция до и после выполнения проблемного набора инструкций
dapp dimg build --introspect-error  
dapp dimg build --introspect-before-error

# интроспекция собранной стадии STAGE
dapp dimg build --introspect-stage STAGE
dapp dimg build --introspect-artifact-stage STAGE

# интроспекция до выполнения инструкций стадии STAGE
dapp dimg build --introspect-before STAGE
dapp dimg build --introspect-artifact-before STAGE    
```
