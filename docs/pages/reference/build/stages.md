---
title: Stages
sidebar: reference
permalink: reference/build/stages.html
---

## Motivation

Что _обычно_ нужно запустить во время сборки?

* добавить код
* установить системное ПО
* установить системные зависимости
* установить прикладные зависимости
* настроить системное ПО
* настроить приложение

В каком порядке нужно выполнять эти шаги, чтобы сборка была быстрой, а _пересборка_ не занимала лишнего места? 

Нужно разделить сборку на более крупные шаги с чётким назначением. В dapp такие шаги называются стадиями.

## What is a stage for?

Стадия — это логически сгруппированный набор инструкций конфигурации, а также условий и правил, по которым выполняется сборка этих инструкций.

Сборочный процесс в dapp построен из последовательной сборки стадий. Набор стадий и порядок их следования предопределён. Каждая стадия собирается в сборочном контейнере из образа предыдущей стадии. Результатом сборки стадий является сборочный кэш, который определяет собираемый образ.

Использование кэша при повторных сборках возможно благодаря индентификатору сборочного кэша, сигнатуре, которая вычисляется для стадий при каждой сборке. При сохранении сборочного кэша сигнатура используется при тегировании. Это позволяет при сборке собирать только те стадии, сборочных кэш которых отсутствует в docker. Подробнее про работу сборочного кэша в отдельной статье.

Сигнатура стадии (stage signature) состоит из контрольной суммы правил сборки, зависимостей стадии и сигнатуры предыдущей стадии. При отсутствии правил и зависимостей стадия игнорируется, используется сигнатура предыдущей стадии.

TODO: конвейер стадий dimg

TODO: конвейер стадий артефакта

**Всю магию работы со стадиями делает за вас dapp, вам нужно только правильно прописать инструкции по сборке в конфигурации.**
